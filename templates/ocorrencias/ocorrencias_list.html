{% extends '_base.html' %}
{% load static %}
{% block content %}


<div class=" container mt-4 w-100">
    <!-- Cabeçalho -->
    <div class="mb-4 d-flex align-items-center gap-2">
        <a href="javascript:history.back()" class="text-decoration-none d-flex align-items-center">
            <img src="{% static 'img/seta-voltar.png' %}" class="nav-icon-import-back me-2" alt="">
            <span class="fw-bold font-name-import ml-2">Busca Avançada</span>
        </a>
    </div>

    <p class="text-muted ">Pesquise e filtre ocorrências com múltiplos critérios</p>

    <div class="row ">
        <!-- FILTROS -->
            <div class="col-12" >
            <div class="container-filter bg-white shadow rounded mb-3 compact-text">
                <div class="d-flex align-items-center p-3 border-bottom">
                <img src="{% static 'img/filtro.png' %}" class="me-2" alt="Filtro" style="width: 22px; height: 22px;">
                <h5 class="font-filtre mb-0 ml-2">Filtros de Busca</h5>
                </div>

                <form action="?" method="GET" class="p-3 row g-2 align-items-end">
                <!-- Nome da Vítima -->
                <div class="col-md-6 col-sm-4">
                    <label for="vitima" class="form-label mb-1">Vítima</label>
                    <input type="text" name="vitima" id="vitima"
                        value="{{ request.GET.vitima }}"
                        class="form-control form-control-sm"
                        placeholder="Nome da vítima">
                </div>

                <!-- Nome do Agressor -->
                <div class="col-md-6 col-sm-4">
                    <label for="agressor" class="form-label mb-1">Agressor</label>
                    <input type="text" name="agressor" id="agressor"
                        value="{{ request.GET.agressor }}"
                        class="form-control form-control-sm"
                        placeholder="Nome do agressor">
                </div>

                <!-- Tipo de Violência -->
                <div class="col-md-3 col-sm-4 mt-3">
                    <label for="violencia" class="form-label mb-1">Violência</label>
                    <input type="text" name="violencia" id="violencia"
                        value="{{ request.GET.violencia }}"
                        class="form-control form-control-sm"
                        placeholder="Ex: Doméstica">
                </div>

                <!-- Município -->
                <div class="col-md-3 col-sm-4">
                    <label for="municipio" class="form-label mb-1">Município</label>
                    <input type="text" name="municipio" id="municipio"
                        value="{{ request.GET.municipio }}"
                        class="form-control form-control-sm"
                        placeholder="Ex: Guanambi">
                </div>

                <!-- DATA REGISTRO -->
                <div class="col-md-3 col-sm-4">
                    <label for="registro" class="form-label mb-1">Data Registro</label>
                    <input type="date" name="registro" id="registro"
                        value="{{ request.GET.registro }}"
                        class="form-control form-control-sm">
                </div>

                

                <!-- Botões -->
                <div class="col-md-3 col-sm-6 d-flex gap-2 mt-3 ">
                    <button type="submit" class="btn btn-primary btn-sm w-100">
                    <i class="bi bi-search me-1"></i> Buscar
                    </button>
                    <a href="{% url 'listar_ocorrencias' %}" class="btn btn-light btn-sm w-100 ml-1">Limpar</a>
                </div>
                </form>
            </div>
            </div>


        <!-- RESULTADOS -->
        <div class="mb-5">
            <div class="bg-white main-container shadow rounded p-3">
                {% if ocorrencias %}
                    <div class="table-responsive table-data" >
                        <table class="table table-bordered table-striped table-sm compact-text align-middle">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th>VÍTIMA(S)</th>
                                    <th>AGRESSOR(ES)</th>
                                    <th>MUNICÍPIO</th>
                                    <th>DATA REGISTRO</th>
                                    <th>NATUREZA</th>
                                    <th>DATA IMPORTAÇÃO</th>
                                </tr>
                            </thead>
                            <tbody class="">
                                {% for ocorrencia in ocorrencias %}
                                    <tr class="dados-tabela">
                                        <td>
                                            {% for v in ocorrencia.vitimas.all %}
                                                {{ v.nome }}{% if not forloop.last %}, {% endif %}
                                            {% empty %}
                                                -
                                            {% endfor %}
                                        </td>
                                        <td>
                                            {% for a in ocorrencia.agressores.all %}
                                                {{ a.nome }}{% if not forloop.last %}, {% endif %}
                                            {% empty %}
                                                -
                                            {% endfor %}
                                        </td>
                                        <td>{{ ocorrencia.municipio }}</td>
                                        <td>{{ ocorrencia.data_registro|date:"d/m/Y" }}</td>
                                        <td>{{ ocorrencia.natureza }}</td>
                                        <td>{{ ocorrencia.created_at|date:"d/m/Y H:i" }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="alert alert-info compact-text mb-0">
                        Nenhuma ocorrência encontrada com os filtros aplicados.
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
